# 工作交接规则

> 所有参与这个项目的人（Claude、其他 AI、人类）都必须遵守以下规则。
> 不遵守这些规则会导致交接混乱、重复工作、或破坏已有功能。

---

## 规则一：每次开始工作前，先读这三个文件

```
.workspace/RULES.md        ← 本文件，规则
.workspace/HANDOVER.md     ← 项目全貌和环境配置
.workspace/TASKS.md        ← 任务状态总表（唯一真相来源）
```

不读完不准动代码。

---

## 规则二：任务状态必须实时更新

TASKS.md 里每个任务有且只有四种状态：

| 标记 | 含义 |
|------|------|
| `[ ]` 待开始 | 还没动 |
| `[~]` 进行中 | 正在做，必须注明做到哪里了 |
| `[x]` 已完成 | 做完了，必须注明完成时间和 commit |
| `[!]` 有问题 | 做了但有 bug 或未解决问题，必须说明 |

**进行中必须写进度**，例如：
```
[~] TASK-1 持久化共享工作区
    进度：已完成容器启动 API，正在修改 agent/route.ts 使用 docker exec
    卡在：docker exec 权限问题，tmp 目录无法写入
    下一步：改用 /workspace/tmp 替代 /tmp
```

---

## 规则三：完成任务后必须做的事

1. 在 TASKS.md 把状态改为 `[x]`
2. 写上完成时间和 git commit hash
3. 写上"测试方法"和"测试结果"
4. 如果发现新问题，在 TASKS.md 末尾新增任务条目
5. git commit 并 push

---

## 规则四：中途停下来必须做的事

1. 在 TASKS.md 把状态改为 `[~]`
2. 写清楚：**做到哪一步了**、**下一步要做什么**、**有什么坑**
3. git commit 并 push（哪怕代码没做完，文档要先 push）

---

## 规则五：不能做的事

- 不能改已完成任务对应的代码，除非在 TASKS.md 新建一个"修改 TASK-X"的任务
- 不能删除 .workspace/ 目录下的任何文件
- 不能跳过测试直接标记完成
- 不能在没有更新 TASKS.md 的情况下 push 代码

---

## 规则六：发现文档和代码不符，以代码为准，但必须修正文档

如果你读 HANDOVER.md 发现描述和实际代码不一致，说明上一个人没有更新文档。
你需要：
1. 以实际代码为准
2. 修正 HANDOVER.md 的错误描述
3. 在 TASKS.md 新增一条"文档修正"记录

---

## 规则七：每次 commit message 格式

```
<类型>: <简短描述>

任务：TASK-X
状态：进行中 / 已完成
做了：具体做了什么
测试：怎么测试的，结果如何

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
```
